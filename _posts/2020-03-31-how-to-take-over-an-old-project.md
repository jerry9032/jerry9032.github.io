---
title: 如何快速接手一个老项目
date: 2020-03-31 21:26:34
category: Software Engineer
disqus: y
---

我刚进公司的时候，是一个小实习生，负责维护一个三四年的老项目——一个中间件。但由于在社区的架构组，这个项目其实被广泛应用于社区的各个业务线，每天有百亿次的调用，这让我非常胆战心惊。后来又陆续维护过好几个模块，都是有一定成熟度、流量非常大、但还有 bug 的项目。

其实在公司里，参与的每一个项目都是从零开始是不可能的。而且作为一个新手程序员，很多时候，给你的可能只是一个小模块让你去修 bug，这个才是常态。

## 先看总体设计

当领导告诉你，下一个工作内容是维护某项目，你下载了全部代码，然后咋办？

首先，不要被浩如烟海又陌生怪诞的代码吓得惊掉下巴，绝对不要做的事是一开始就逐行读代码，而是要去请教上一任维护者，这个项目的代码目录结构、功能点、历史沿革都是什么样的。如果上一任已经不在了，你要竭力在公司的知识库中搜寻全部相关的文档，比如：

- 项目初始的总体设计 & 详细设计文档、架构图
- 大功能点的需求 & 设计文档
- bugfix 和 case study 文档
- 使用者记录的坑

但是悲剧的是，由于人类的短期目的性，基本不会有前人把这些资料整理出一个完整又可靠的全集，千万不要因此而懊恼。搜到的这些文档很多都有可能过时了，我们面对越久远的文档，越要带着批判的眼光去看，不能全信。收集完资料后通读一遍，交叉比对，要像查案一样，尽可能还原事实真相。

第一次看，力求能搞明白总体架构、大功能点，而不要过早的陷入细节中。

## 看线上部署、自己运行

这一步主要是更深刻的理解该项目的主要功能点。申请一个线上机器的权限，登陆后主要看一下线上实际运行的模块数和配置。

- 和架构有关的配置：揭示跨地域的功能特性
- 模块数、线程数、进程数：线上压力相关，容易看出哪个模块是压力瓶颈
- 各种超时配置：一般是折中后的最佳实践，超时配高了影响响应时间，配低了容易成功率
- 其它独特的模块配置

搞清楚线上配置以及这么配置的原因了之后，就可以尝试自己搭一个这样的环境跑一下代码。此处要注意版本问题，用和线上一样的版本去编译运行，否则会出现各种奇怪的配置项、启动参数、数据格式不兼容的问题。

## 改个简单的bug/feature

选 bug/feature list 里最简单的一个，走一遍从修复-自测-提测-上线的整体程序，不仅能加深对代码的理解，更能加强自信。人就是这么奇怪，只要稍稍有一点自信，就能形成正反馈回路，加快对程序的理解。修改时尽量只 focus 在当前项目，依赖库只需要了解其用途即可，不要去修改。

而后，可以慢慢提高 bug 的难度，例如这样提高：

1. 输入输出型的 bug，配置与日志等
2. 功能逻辑型的 bug，某个地方的实现有逻辑错误、不严谨
3. 设计型 bug：在大压力下可能会导致响应慢、内存泄漏、崩溃等
4. 系统型 bug：模块划分问题、交互问题

## 一些常见问题

有段代码实在是看不懂，怎么办？跟踪，单步调试查看变量。涉及数学计算的公式，不知道怎么来的？修改一下公式，看看输出是如何变化的。

任何代码改动都要备份，任何代码提交都要反复的 git diff 来确认自己有没有多改或者漏改。

对于局部重构类的工作特别要小心，尽量在原有基础上包装，必须重构时要对新旧两份代码写好单测，确保功能完全一致。有时系统不仅兼容了 feature，还兼容了 bug。你重构完代码顺手把 bug 修了，系统可能就崩了。

## 总结

不停的试、不停的改，才能不断理解。其实，维护项目越多，接手下一个项目的时候就会速度越快。因为项目的组织都有一定的范式，把套路都弄明白了，下次一眼就知道他是什么套路了。

维护项目也是自己设计项目的基础，在前人的基础上总结出什么是精妙的，什么是坑，才能在以后自己主导项目设计时扬长避短。

